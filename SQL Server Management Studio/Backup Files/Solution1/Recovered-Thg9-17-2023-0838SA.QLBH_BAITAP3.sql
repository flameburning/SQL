CREATE DATABASE QLBH_BAITAP3
ON PRIMARY(
NAME = QLBH_BAITAP3,
FILENAME='C:\Program Files\Microsoft SQL Server\MSSQL11.SQLEXPRESS\MSSQL\DATA\QLBH_BAITAP3.MDF',
SIZE=50MB,
MAXSIZE= 200MB,
FILEGROWTH=10MB)
LOG ON(
NAME= QLBH_BAITAP3_Log,
FILENAME= 'C:\Program Files\Microsoft SQL Server\MSSQL11.SQLEXPRESS\MSSQL\DATA\QLBH_BAITAP3.LDF',
SIZE=10MB,
MAXSIZE= UNLIMITED,
FILEGROWTH = 5MB
)
GO 
USE QLBH_BAITAP3
GO
-----TẠO BẢNG -------------
CREATE TABLE VATTU(
MaVTu char(4)NOT NULL,
TenVTu varchar(100)NOT NULL,
DvTinh varchar(10) NULL DEFAULT(''),
PhanTram real CONSTRAINT CK_VATTU_PhanTram CHECK(PhanTram BETWEEN 0 AND 100),
PRIMARY KEY (MaVTu)
GO

CREATE TABLE NHACC(
 MaNhaCC char(3) NOT NULL,
 TenNhaCC varchar(100)NOT NULL,
 DiaChi varchar(200) NOT NULL,
 DienThoai varchar(20) CONSTRAINT DF_DienThoai DEFAULT ('Chưa có')
 PRIMARY KEY (MaNhaCC))
 GO 
 
 CREATE TABLE DONDH(
 SoDh char(4)NOT NULL ,
 NgayDh datetime CONSTRAINT DF_NgayDH DEFAULT(GETDATE()),
 MaNhaCC char(3)NOT NULL)
 GO 
  
CREATE TABLE CTDONDH(
SoDh char(4) NOT NULL ,
MaVTu char(4)NOT NULL,
SlDat int NOT NULL,
PRIMARY KEY (SoDh,MaVTu),
CONSTRAINT FK_CTDONDH_SoDh FOREIGN KEY(SoDh)REFERENCES NHACC(SoDh)
         ON UPDATE CASCADE
		 ON DELETE NO ACTION,
CONSTRAINT FK_CTDONDH_MaVTu FOREIGN KEY(MaVTu) REFERENCES VATTU(MaVTu)
       ON UPDATE CASCADE
	   ON DELETE NO ACTION 
)
GO 
CREATE TABLE PNHAP(
SoPn char(4) PRIMARY KEY,
NgayNhap datetime CONSTRAINT DF_NgayNhap DEFAULT (GETDATE()),
SoDh char(4) NOT NULL CONSTRAINT FK_PNHAP_SoDh FOREIGN KEY (SoDh) REFERENCES DONDH(SoDh)
)
GO 
CREATE TABLE CTPNHAP(
SoPn char(4) NOT NULL,
MaVTu char(4) NOT NULL CONSTRAINT FK_CTPNHAP_MaVTu FOREIGN KEY  REFERENCES VATTU(MaVTu)
             ON UPDATE CASCADE 
			 ON DELETE NO ACTION ,
SlNhap int NOT NULL CONSTRAINT CK_SlNhap CHECK(SlNhap >0),
DgNhap money NOT NULL CONSTRAINT CK_DgNhap CHECK(DgNhap >0),
PRIMARY KEY (SoPn,MaVTu)
)
GO

CREATE TABLE PXUAT (
SoPX char(4) PRIMARY KEY,
NgayXuat datetime CONSTRAINT DF_NgayXuat DEFAULT(GETDATE()),
TenKH varchar(100) NOT NULL 
)
GO 

CREATE TABLE CTPXUAT (
SoPX char(4) NOT NULL,
MaVTu char(4) NOT NULL CONSTRAINT FK_CTPXUAT_MaVTu FOREIGN KEY REFERENCES VATTU(MaVTu)
        ON UPDATE CASCADE
		ON DELETE NO ACTION ,
SlXuat int NOT NULL CONSTRAINT CK_SlXuat CHECK(SlXuat>0),
DgXuat money NOT NULL CONSTRAINT CK_DgXuat CHECK(DgXuat>0),
PRIMARY KEY (SoPX,MaVTu)
)
GO 

CREATE TABLE TONKHO(
NamThang char(6) NOT NULL,
MaVTu char(4) NOT NULL CONSTRAINT FK_TONKHO_MaVTu FOREIGN KEY  REFERENCES VATTU(MaVTu),
SLDau int NOT NULL CONSTRAINT CK_SLDau CHECK(SLDau>0),
TONGSLN int NOT NULL CONSTRAINT CK_TONGSLN CHECK (TONGSLN >0),
TONGSLX int NOT NULL CONSTRAINT CK_TONGSLX CHECK(TONGSLX >0),
SLCuoi  AS (SLDau + TongSLN - TongSLX),
PRIMARY KEY (NamThang,MaVTu)
)
GO 

INSERT INTO VATTU VALUES ('DD01','Đầu DVD Hitachi 1 đĩa','Bộ',40)
INSERT INTO VATTU VALUES ('DD02','Đầu DVD Hitachi 3 đĩa','Bộ',40)
INSERT INTO VATTU VALUES ('TL15', 'Tủ lạnh Sanyo 150 lít ','Cái',25)
INSERT INTO VATTU VALUES('TL90','Tue lạnh Sanyo 90 lít','Cái',20)
INSERT INTO VATTU VALUES ('TV14','Tivi Sony 14 inches','Cái',15)
INSERT INTO VATTU VALUES ('TV21','Tivi Sony 21 inches','Cái',10)
INSERT INTO VATTU VALUES ('TV29','Tivi Sony 29 inches','Cái',10)
INSERT INTO VATTU VALUES ('VD01','Đầu VCD Sony 1 đĩa','Bộ',30)
INSERT INTO VATTU VALUES ('VD02','Đầu VCD Sony 3 đĩa','Bộ',30)
GO 


INSERT INTO NHACC VALUES ('C01','Lê Minh Thành','54,Kim Mã, Cầu Giấy, Hà Nội','8781024')
INSERT INTO NHACC VALUES('C02','Trần Quang Anh','145,Hùng Vương , Hải Dương','7698154')
INSERT INTO NHACC VALUES ('C03','Bùi Hồng Phương','154/85 ,Lê Chân,Hải Phòng','9600125')
INSERT INTO NHACC VALUES ('C04','Vũ Nhật Thắng','198/40,Hương Lộ 14 QTB HCM ','8757757')
INSERT INTO NHACC VALUES ('C05','Nguyễn Thị Thúy','178 Nguyễn Văn Luông Đà Lạt','7964251')
INSERT INTO NHACC VALUES ('C07','Cao Minh Trung','125 Lê Quang Sung Nha Trang','')
GO 


INSERT INTO DONDH VALUES('D001','2012/01/15','C03')
INSERT INTO DONDH VALUES ('D002','2012/01/30','C01')
INSERT INTO DONDH VALUES('D003','2012/02/10','C02')
INSERT INTO DONDH VALUES('D004','2012/02/17','C05')
INSERT INTO DONDH VALUES('D005','2012/03/01','C02')
INSERT INTO DONDH VALUES('D006','2012/03/12','C05')
GO 

INSERT INTO CTDONDH VALUES ('D001','DD01',10)
INSERT INTO CTDONDH VALUES ('D001','DD02',15)
INSERT INTO CTDONDH VALUES ('D002','VD02',30)
INSERT INTO CTDONDH VALUES ('D003','TV14',10)
INSERT INTO CTDONDH VALUES ('D003','TV29',20)
INSERT INTO CTDONDH VALUES ('D004','TL90',10)
INSERT INTO CTDONDH VALUES ('D005','TV14',10)
INSERT INTO CTDONDH VALUES ('D005','TV29',20)
INSERT INTO CTDONDH VALUES ('D006','TV14',10)
INSERT INTO CTDONDH VALUES ('D006','TV29',20)
INSERT INTO CTDONDH VALUES ('D006','VD01',20)
GO

INSERT INTO PNHAP VALUES ('N001','2012/01/17','D001')
INSERT INTO PNHAP VALUES ('N002','2012/01/20','D001')
INSERT INTO PNHAP VALUES ('N003','2012/01/31','D002')
GO

INSERT INTO CTPNHAP VALUES ('N001','DD01',8,2500000)
INSERT INTO CTPNHAP VALUES ('N001','DD02',10,3500000)
INSERT INTO CTPNHAP VALUES ('N002','DD01',2,2500000)
INSERT INTO CTPNHAP VALUES ('N002','DD02',5,3500000)
INSERT INTO CTPNHAP VALUES ('N003','VD02',30,2500000)
INSERT INTO CTPNHAP VALUES ('N004','TV14',5,2500000)
INSERT INTO CTPNHAP VALUES ('N004','TV29',12,3500000)
GO 

INSERT INTO PXUAT VALUES('X001','2012/01/17','Nguyễn Ngọc Phương Nhi')
INSERT INTO PXUAT VALUES('X002','2012/01/25','Nguyễn Hồng Phương ')
INSERT INTO PXUAT VALUES('X003','2012/01/31','Nguyễn Tuán Tú')
GO

INSERT INTO CTPXUAT VALUES('X001','DD01',2,3500000)
INSERT INTO CTPXUAT VALUES('X002','DD01',1,3500000)
INSERT INTO CTPXUAT VALUES('X002','DD02',5,4900000)
INSERT INTO CTPXUAT VALUES('X003','DD01',3,3500000)
INSERT INTO CTPXUAT VALUES('X003','DD02',2,4900000)
INSERT INTO CTPXUAT VALUES('X003','VD02',10,3250000)
GO

INSERT INTO TONKHO VALUES ('201201','DD01',0,10,6,4)
INSERT INTO TONKHO VALUES ('201201','DD02',0,15,7,8)
INSERT INTO TONKHO VALUES ('201201','VD02',0,30,10,20)
INSERT INTO TONKHO VALUES ('201202','DD01',4,0,0,4)
INSERT INTO TONKHO VALUES ('201202','DD02',8,0,0,8)
INSERT INTO TONKHO VALUES ('201202','VD02',20,0,0,20)
INSERT INTO TONKHO VALUES ('201202','TV14',5,0,0,5)
INSERT INTO TONKHO VALUES ('201202','TV29',12,0,0,12)
GO



